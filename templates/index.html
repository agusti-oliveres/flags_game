<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flag Guessing Game</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div id="game-container">
        <h1>Guess the Country</h1>
        <div class="toggle-container">
            <span>Flag Mode</span>
            <label class="switch">
                <input type="checkbox" id="game-mode-toggle">
                <span class="slider round"></span>
            </label>
            <span>Color Mode</span>
        </div>
        <div id="flag-container">
            <img id="flag" src="" alt="Country Flag">
        </div>
        <div id="options-container"></div>
        <div id="result"></div>
        <div id="score">Score: <span id="correct-guesses">0</span> / <span id="total-guesses">0</span></div>
    </div>
    <script>
        let correctAnswer = '';
        let correctFlagCode = ''; // Store flag code for later use
        let correctAvgColor = ''; // Store average color for later use
        let correctGuesses = 0;
        let totalGuesses = 0;
        let isColorMode = false;

        function updateScore() {
            document.getElementById('correct-guesses').textContent = correctGuesses;
            document.getElementById('total-guesses').textContent = totalGuesses;
        }

        function getNewFlag() {
            fetch('/get_flag')
                .then(response => response.json())
                .then(data => {
                    correctAnswer = data.correct_answer;
                    correctFlagCode = data.code; // Save the flag code for later use
                    correctAvgColor = data.avg_color; // Save the average color for later use
                    displayOptions(data.options);
                    document.getElementById('result').textContent = '';
                    document.getElementById('result').className = '';

                    // In Color Mode, initially only show the average color
                    if (isColorMode) {
                        document.getElementById('flag-container').innerHTML = `
                            <div id="color-box" style="background-color: ${correctAvgColor}; width: 200px; height: 133px;"></div>
                        `;
                    } else {
                        // In Flag Mode, show the flag
                        document.getElementById('flag-container').innerHTML = `<img id="flag" src="https://flagcdn.com/w320/${correctFlagCode}.png" alt="Country Flag">`;
                    }
                });
        }

        function displayOptions(options) {
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add('option-button');
                button.addEventListener('click', () => checkGuess(option));
                optionsContainer.appendChild(button);
            });
        }

        function checkGuess(guess) {
            totalGuesses++;
            const resultElement = document.getElementById('result');
            
            if (guess === correctAnswer) {
                correctGuesses++;
                resultElement.textContent = 'Correct! Well done!';
                resultElement.className = 'correct';
            } else {
                resultElement.textContent = `Wrong. The correct answer was ${correctAnswer}.`;
                resultElement.className = 'incorrect';
            }
            
            updateScore();
            disableOptions();

            // In Color Mode, after the guess, reveal the original flag next to the color box for 2 seconds
            if (isColorMode) {
                setTimeout(() => {
                    document.getElementById('flag-container').innerHTML = `
                        <div style="display: flex; justify-content: center; align-items: center; gap: 10px;">
                            <div id="color-box" style="background-color: ${correctAvgColor}; width: 200px; height: 133px;"></div>
                            <img id="flag" src="https://flagcdn.com/w320/${correctFlagCode}.png" alt="Country Flag" style="height: 133px;">
                        </div>
                    `;
                }, 500); // Show the flag 500ms after the guess is made
            }

            // Switch to the next flag after 2 seconds of showing the original flag
            setTimeout(getNewFlag, 2500);
        }

        function disableOptions() {
            const buttons = document.querySelectorAll('.option-button');
            buttons.forEach(button => {
                button.disabled = true;
            });
        }

        document.getElementById('game-mode-toggle').addEventListener('change', function() {
            isColorMode = this.checked;
            getNewFlag();
        });

        getNewFlag();
        updateScore();
    </script>
</body>
</html>
